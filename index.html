<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Interactiva - Psicología</title>
  <style>
    body {
      margin: 0;
      background-color: #111;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
    }
    h1 {
      text-align: center;
      padding: 1rem 0;
    }
    #starTotalCounter {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #222;
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 1.2rem;
      color: gold;
      font-weight: 700;
      z-index: 1000;
      box-shadow: 0 0 10px gold;
    }
    #resetBtn {
      margin: 1rem auto 2rem auto;
      display: block;
      background-color: #bb2222;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 0 8px #bb2222;
    }
    #resetBtn:hover {
      background-color: #dd4444;
    }
    .container {
      display: flex;
      overflow-x: auto;
      padding: 1rem;
      gap: 15px;
    }
    .year {
      flex: 0 0 auto;
      width: 280px;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 10px;
      background-color: #222;
    }
    .year h2 {
      text-align: center;
      margin-bottom: 10px;
      border-bottom: 1px solid #555;
      padding-bottom: 5px;
      font-size: 1.3rem;
    }
    .subject {
      padding: 10px 14px;
      border-radius: 6px;
      margin: 6px 0;
      position: relative;
      cursor: pointer;
      background-color: #eee;
      color: #000;
      font-weight: 600;
      user-select: none;
      box-shadow: 0 0 4px rgba(255,255,255,0.1);
      transition: background-color 0.2s, transform 0.2s;
    }
    .subject:hover {
      transform: scale(1.03);
    }
    .subject.approved {
      background-color: #28a745;
      color: #fff;
      font-weight: 700;
    }
    .subject.locked {
      background-color: #333;
      color: #777;
      cursor: not-allowed;
    }
    .subject.unlocked {
      background-color: #888;
      color: #fff;
    }
    .branch-group {
      margin-top: 15px;
      padding-top: 8px;
      border-top: 1px solid #444;
    }
    .branch-title {
      font-size: 1rem;
      font-weight: bold;
      margin-top: 10px;
      margin-bottom: 5px;
      padding: 6px 10px;
      background-color: #333;
      border-radius: 6px;
      color: #eee;
    }
  </style>
</head>
<body>
  <h1>Malla Interactiva - Psicología</h1>
  <div id="starTotalCounter">★ 0</div>
  <div class="container" id="malla"></div>
  <button id="resetBtn">Resetear Malla</button>
  <script>
    const materias = [
      {
        columna: "CBC",
        materias: ["Biología", "Semiología", "Psicología", "Pensamiento Científico", "Matemática", "Sociedad y Estado"]
      },
      {
        columna: "Formación General",
        materias: [
          { titulo: "Psicología General" },
          "Estadística|CBC",
          { titulo: "Psicología Social" },
          "Psicoanálisis: Freud|Psicología General",
          "Psicología y Epistemología Genética|Psicología General",
          "Neurofisiología|Psicología General",
          "Historia de la Psicología|Psicología General",
          "Metodología de la Investigación|Estadística",
          "Salud Pública y Salud Mental|Psicología Social",
          "Teoría y Técnica de Grupos|Psicología Social",
          "Psicología Evolutiva: Niñez|Psicología y Epistemología Genética",
          "Psicología Evolutiva: Adolescencia|Psicología Evolutiva: Niñez",
          "Psicopatología|Psicoanálisis: Freud, Neurofisiología",
          "Exploración y Diagnóstico I|Psicopatología, Psicología Evolutiva: Adolescencia",
          "Exploración y Diagnóstico II|Exploración y Diagnóstico I"
        ]
      },
      {
        columna: "Formación Profesional",
        materias: [
          "Psicología, Ética y DDHH|Historia de la Psicología",
          "Psicología Educacional|Exploración y Diagnóstico II",
          "Psicología Institucional|Psicología Educacional",
          "Psicología del Trabajo|Psicología Institucional",
          "Clínica de Adultos|Psicopatología, Exploración y Diagnóstico II",
          "Psicología Jurídica|Clínica de Adultos",
          "Psicoterapias|Clínica de Adultos",
          "Práctica Profesional e Investigación|Psicología Educacional, Clínica de Adultos"
        ]
      },
      {
        columna: "Electivas / Idiomas / Tesis",
        materias: [
          "Electiva I",
          "Electiva II",
          "Electiva Práctica",
          "Requisito Idioma",
          "Tesis|todas"
        ]
      }
    ];

    const malla = document.getElementById("malla");
    const counter = document.getElementById("starTotalCounter");
    let aprobadas = JSON.parse(localStorage.getItem("aprobadasPsico")) || [];

    function estaDesbloqueada(nombre, correlativas) {
      if (!correlativas || correlativas === "") return true;
      if (correlativas === "todas") {
        return [...document.querySelectorAll('.subject')].every(el => el.classList.contains('approved') || el.classList.contains('locked') === false);
      }
      return correlativas.split(',').every(c => aprobadas.includes(c.trim()));
    }

    function actualizar() {
      malla.innerHTML = "";
      let totalAprobadas = 0;

      materias.forEach(({ columna, materias }) => {
        const colDiv = document.createElement("div");
        colDiv.className = "year";

        const h2 = document.createElement("h2");
        h2.textContent = columna;
        colDiv.appendChild(h2);

        materias.forEach(m => {
          if (typeof m === 'object' && m.titulo) {
            const group = document.createElement("div");
            group.className = "branch-title";
            group.textContent = m.titulo;
            colDiv.appendChild(group);
          } else {
            const [nombre, corrs] = typeof m === 'string' ? m.split('|') : [m, ""];
            const div = document.createElement("div");
            div.textContent = nombre;
            div.className = "subject";

            if (aprobadas.includes(nombre)) {
              div.classList.add("approved");
              totalAprobadas++;
            } else if (estaDesbloqueada(nombre, corrs)) {
              div.classList.add("unlocked");
              div.addEventListener("click", () => {
                aprobadas.push(nombre);
                localStorage.setItem("aprobadasPsico", JSON.stringify(aprobadas));
                actualizar();
              });
            } else {
              div.classList.add("locked");
            }

            colDiv.appendChild(div);
          }
        });

        malla.appendChild(colDiv);
      });

      counter.textContent = `★ ${totalAprobadas}`;
    }

    document.getElementById("resetBtn").addEventListener("click", () => {
      localStorage.removeItem("aprobadasPsico");
      aprobadas = [];
      actualizar();
    });

    actualizar();
  </script>
</body>
</html>
